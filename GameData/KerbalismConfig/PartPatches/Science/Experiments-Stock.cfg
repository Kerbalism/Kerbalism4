// ============================================================================
// atmosphereAnalysis
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[atmosphereAnalysis]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 4
		SciencePoints = 16
		Situation = Surface@Biomes
		Situation = FlyingLow@Biomes
		Situation = FlyingHigh
		BodyAllowed = Atmospheric
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = atmosphereAnalysis
	moduleName = ModuleKsmExperiment
	ExperimentId = atmosphereAnalysis
	Duration = 45s
	RequiredEC = 2.4
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[atmosphereAnalysis]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[atmosphereAnalysis]]	{}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = atmosphereAnalysis
	}
}

// ============================================================================
// mysteryGoo
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[mysteryGoo]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.0073
		DataSize = 429
		SciencePoints = 6
		Situation = SrfLanded
		Situation = SrfSplashed
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = mysteryGoo
	moduleName = ModuleKsmExperiment
	ExperimentId = mysteryGoo
	Duration = 10m30s
	RequiredEC = 0.18
	Samples = 1
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[mysteryGoo]]]:FOR[KerbalismPass0]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[mysteryGoo]]	{}
	
	MODULE
	{
		name = ModuleKsmExperiment
		definition = mysteryGoo
	}
}

// add a private drive to store the samples
@PART[*]:HAS[@MODULE[ModuleKsmExperiment]:HAS[#definition[mysteryGoo]]]:FOR[KerbalismPass0]:NEEDS[KerbalismScience]
{
	MODULE
	{
		name = ModuleKsmDrive
		experiment_id = mysteryGoo
		dataCapacity = 0
		sampleCapacity = 1
	}
}

// setup animation on the stock goo
@PART[GooExperiment]:FOR[KerbalismPass0]:NEEDS[KerbalismScience]
{
	!MODULE[ModuleAnimateGeneric] {}
	@MODULE[ModuleKsmExperiment]
	{
		%anim_deploy = Deploy
	}
}

// ============================================================================
// mobileMaterialsLab
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[mobileMaterialsLab]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.032
		DataSize = 2400
		SciencePoints = 18
		SampleMass = 0.032
		Situation = SrfLanded
		Situation = SrfSplashed
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = mobileMaterialsLab
	moduleName = ModuleKsmExperiment
	ExperimentId = mobileMaterialsLab
	RequiredEC = 2.04
	Duration = 20m						//20-ish min. (low duration due to aids with manually flying in atmo)
	Samples = 1
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[mobileMaterialsLab]]]:FOR[KerbalismPass0]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[mobileMaterialsLab]] {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = mobileMaterialsLab
	}
}

// add a private drive to store the samples
@PART[*]:HAS[@MODULE[ModuleKsmExperiment]:HAS[#definition[mobileMaterialsLab]]]:FOR[KerbalismPass0]:NEEDS[KerbalismScience]
{
	MODULE
	{
		name = ModuleKsmDrive
		experiment_id = mobileMaterialsLab
		dataCapacity = 0
		sampleCapacity = 4
	}
}

// setup animation on the stock part
@PART[science_module]:FOR[KerbalismPass0]:NEEDS[KerbalismScience]
{
	!MODULE[ModuleAnimateGeneric] {}
	@MODULE[ModuleKsmExperiment]
	{
		%anim_deploy = Deploy
	}
}

// ============================================================================
// seismicScan
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[seismicScan]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 200
		SciencePoints = 12
		Situation = SrfLanded@Biomes
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = seismicScan
	moduleName = ModuleKsmExperiment
	ExperimentId = seismicScan
	Duration = 14d
	RequiredEC = 0.0076
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[seismicScan]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[seismicScan]]	 {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = seismicScan
	}
}

// ============================================================================
// barometerScan
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[barometerScan]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 3.5
		SciencePoints = 9
		Situation = Surface@Biomes
		Situation = FlyingLow@Biomes
		Situation = FlyingHigh
		BodyAllowed = Atmospheric
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = barometerScan
	moduleName = ModuleKsmExperiment
	ExperimentId = barometerScan
	Duration = 15m
	RequiredEC = 0.05
	AllowShrouded = false
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[barometerScan]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[barometerScan]]	 {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = barometerScan
	}
}

// ============================================================================
// gravityScan
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[gravityScan]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 26014
		SciencePoints = 16
		Situation = Surface@Biomes
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = gravityScan
	moduleName = ModuleKsmExperiment
	ExperimentId = gravityScan
	Duration = 90d
	RequiredEC = 0.041
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[gravityScan]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[gravityScan]]	 {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = gravityScan
	}
}

// ============================================================================
// temperatureScan
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[temperatureScan]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 0.45
		SciencePoints = 3
		Situation = Surface@Biomes
		Situation = FlyingLow@Biomes
		Situation = FlyingHigh
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = temperatureScan
	moduleName = ModuleKsmExperiment
	ExperimentId = temperatureScan
	Duration = 2m10s
	RequiredEC = 0.002
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[temperatureScan]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[temperatureScan]]	 {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = temperatureScan
	}
}

// ============================================================================
// infraredTelescope
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[infraredTelescope]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 289386462
		SciencePoints = 800
		Situation = InSpaceHigh
		BodyAllowed = HomeBody
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = infraredTelescope
	moduleName = ModuleKsmExperiment
	ExperimentId = infraredTelescope
	Duration = 12y
	RequiredEC = 1.4
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[infraredTelescope]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[infraredTelescope]]	 {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = infraredTelescope
	}
}

// ============================================================================
// crewReport
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[crewReport]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		Description = #kerbalism-experiment-crewreport-desc
		DataSize = 0.2
		SciencePoints = 3
		Situation = Surface@Biomes
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = crewReport
	moduleName = ModuleKsmExperiment
	ExperimentId = crewReport
	Duration = 4m30s
	RequiredEC = 0.01
	CrewOperate = True
}

@PART[*]:HAS[@MODULE:HAS[#experimentID[crewReport]]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[crewReport]]	{}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = crewReport
	}
}

// ============================================================================
// EVA kerbals : surfaceSample, evaReport, evaScience
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[evaReport]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 0.25
		SciencePoints = 10
		Situation = Surface@Biomes
		Situation = InSpaceLow
		Situation = InSpaceHigh
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = evaReport
	moduleName = ModuleKsmExperiment
	ExperimentId = evaReport
	Duration = 45s
	RequiredEC = 0.02
}

@EXPERIMENT_DEFINITION:HAS[#id[surfaceSample]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		SampleMass = 0.025
		DataSize = 980
		SciencePoints = 22
		Situation = SrfLanded@Biomes
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = surfaceSample
	moduleName = ModuleKsmExperiment
	ExperimentId = surfaceSample
	Duration = 40s
	RequiredEC = 0.06
	Samples = 1
	SampleCollecting = true
	Requirements = AstronautComplexLevelMin:2,RndFacilityLevelMin:2
	HideWhenInvalid = true
}

@PART[kerbalEVA*]:HAS[@MODULE[ModuleTripLogger]]:NEEDS[KerbalismScience]
{
	!MODULE:HAS[#experimentID[surfaceSample]]	 {}
	!MODULE:HAS[#experimentID[evaReport]]		 {}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = surfaceSample
	}
	MODULE
	{
		name = ModuleKsmExperiment
		definition = evaReport
	}
}

// ============================================================================
// Asteroid samples
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[asteroidSample]]:NEEDS[KerbalismScience]
{
	// note: we use the stock ModuleAsteroid experiment that we patch at runtime, the sample mass
	// is defined globally in settings.cfg
	KERBALISM_EXPERIMENT
	{
		DataSize = 1694
		SciencePoints = 35

		// Note : this is the stock situationMask/biomeMask
		// It doesn't make a lot of sense , ideally we should use BodyGlobal,
		// but changing it might cause compatibility issues
		// with DMOS asteroid experiments and possibly other mods.
		// Situation = SrfLanded@Biomes
		// Situation = SrfSplashed@Biomes
		// Situation = FlyingLow@Biomes
		// Situation = FlyingHigh
		// Situation = InSpaceLow
		// Situation = InSpaceHigh
	}
}

// ============================================================================
// Comet samples
// ============================================================================

@EXPERIMENT_DEFINITION:HAS[#id[cometSample_short]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 1694
		SciencePoints = 100
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[cometSample_intermediate]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 1694
		SciencePoints = 150
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[cometSample_long]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 1694
		SciencePoints = 300
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[cometSample_interstellar]]:NEEDS[KerbalismScience]
{
	KERBALISM_EXPERIMENT
	{
		DataSize = 1694
		SciencePoints = 1000
	}
}

// ============================================================================
// Resource scanner
// Replace the stock scanner module with our experiment that reproduces the feature
// Do it late (zzz) in case some MM patch is relying on that module being present (ScanSat?)
// ============================================================================

EXPERIMENT_DEFINITION:NEEDS[KerbalismScience]
{
	id = kerbalism_ResourceScanner
	title = #kerbalism-experiment-resourceScanner-title

	KERBALISM_EXPERIMENT
	{
		Description = #kerbalism-experiment-resourceScanner-desc
		DataSize = 2000
		SciencePoints = 8
		UnlockResourceSurvey = true
		Situation = BodyGlobal
		BodyNotAllowed = Suns
	}
}

KSM_MODULE_DEFINITION:NEEDS[KerbalismScience]
{
	name = kerbalism_ResourceScanner
	moduleName = ModuleKsmExperiment
	ExperimentId = kerbalism_ResourceScanner
	Duration = 20d
	RequiredEC = 0.5
	Requirements = OrbitMinInclination:80,OrbitMaxInclination:100,AltitudeBodyRadiusMin:3,AltitudeBodyRadiusMax:4
	AllowShrouded = False
}

@PART[*]:HAS[@MODULE[ModuleOrbitalSurveyor]]:NEEDS[KerbalismScience]:FOR[zzKerbalismPass0]
{
	!MODULE[ModuleOrbitalSurveyor] {}

	MODULE
	{
		name = ModuleKsmExperiment
		definition = kerbalism_ResourceScanner
		useAnimationGroup = True
	}
}
