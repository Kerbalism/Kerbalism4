// ============================================================================
// ISRU chemical plants
// ============================================================================

KSM_MODULE_DEFINITION
{
  name = chemicalProcessBase
  moduleName = ModuleKsmProcessController
  uiGroupName = chemicalProcess
  uiGroupDisplayName = Chemical process // TODO : localization
}

@PART[kerbalism-chemicalplant|MiniISRU]:FOR[KerbalismPass0]
{
  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = #kerbalism-part-chemicalProcess
    moduleID = ksmChemicalProcess
    affectDragCubes = false
    affectFARVoxels = false
  }
  
  MODULE
  {
    name = ModuleKsmProcessController
    switchId = ksmChemicalProcess
  }
}

@PART[ISRU]:FOR[KerbalismPass0]
{
  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = #kerbalism-part-chemicalProcess1
    moduleID = ksmChemicalProcess1
    affectDragCubes = false
    affectFARVoxels = false
  }

  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = #kerbalism-part-chemicalProcess2
    moduleID = ksmChemicalProcess2
    affectDragCubes = false
    affectFARVoxels = false
  }
  
  MODULE
  {
    name = ModuleKsmProcessController
    switchId = ksmChemicalProcess1
  }
  
  MODULE
  {
    name = ModuleKsmProcessController
    switchId = ksmChemicalProcess2
  }
}

@PART[kerbalism-chemicalplant]:FOR[KerbalismPass2]
{
  @KSM_MODULE_DEFINITION[Chem*],*
  {
    capacity = 2
  }
}

@PART[MiniISRU]:FOR[KerbalismPass2]
{
  !MODULE[ModuleResourceConverter],* {}
  !MODULE[ModuleOverheatDisplay] {}
  !MODULE[ModuleCoreHeat] {}
  
  @KSM_MODULE_DEFINITION[Chem*],*
  {
    capacity = 36
  }
}

@PART[ISRU]:FOR[KerbalismPass2]
{
  !MODULE[ModuleResourceConverter],* {}
  !MODULE[ModuleOverheatDisplay] {}
  !MODULE[ModuleCoreHeat] {}

  @KSM_MODULE_DEFINITION[Chem*],*
  {
    capacity = 90
  }
}

// add subtypes to all part switches with a moduleID that matches ksmChemicalProcess*
// do this AFTER[Kerbalism] so that other support configs can add chemical
// processors to parts without having to re-define this list
// We use two tricks to make this work :
// - The B9PS module "moduleID" is intentionally the same as the KsmModule "switchId"
// - The B9PS SUBTYPE "name" is intentionally the same as the KSM_MODULE_DEFINITION "name"
@PART[*]:HAS[@MODULE[ModuleKsmProcessController]:HAS[#switchId[ksmChemicalProcess*]]]:FOR[KerbalismPass1]
{
  KSM_MODULE_DEFINITION 
  {
    name = ChemWaterElectrolysis
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = waterElectrolysis
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemSabatier
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = sabatierProcess
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemHaber
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = haberProcess
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemWasteIncinerator
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = wasteIncinerator
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemWasteCompressor
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = wasteCompressor
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemAnthraquinone
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = anthraquinoneProcess
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemHydrazineProduction
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = hydrazineProduction
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemHydrazineProductionN2
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = hydrazineProductionN2
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemSolidOxideElectrolysis
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = solidOxideElectrolysis
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemMoltenRegolithElectrolysis
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = moltenRegolithElectrolysis
  }
  KSM_MODULE_DEFINITION 
  {
    name = ChemSelectiveCatalyticOxidation
    moduleName = ModuleKsmProcessController
    parentDefinition = chemicalProcessBase
    processName = selectiveCatalyticOxidation
  }
  
  @MODULE[ModuleB9PartSwitch]:HAS[#moduleID[ksmChemicalProcess*]],*
  {
    SUBTYPE
		{
			name = ChemWaterElectrolysis
			title = #KERBALISM_WaterElectrolysis_title
			descriptionSummary = #KERBALISM_WaterElectrolysis_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemSabatier
			title = #KERBALISM_SabatierProcess_title
			descriptionSummary = #KERBALISM_SabatierProcess_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemHaber
			title = #KERBALISM_HaberProcess_title
			descriptionSummary = #KERBALISM_HaberProcess_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemWasteIncinerator
			title = #KERBALISM_WasteIncinerator_title
			descriptionSummary = #KERBALISM_WasteIncinerator_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemWasteCompressor
			title = #KERBALISM_WasteCompressor_title
			descriptionSummary = #KERBALISM_WasteCompressor_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemAnthraquinone
			title = #KERBALISM_AnthraquinoneProcess_title
			descriptionSummary = #KERBALISM_AnthraquinoneProcess_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemHydrazineProduction
			title = #KERBALISM_HydrazineProduction_title
			descriptionSummary = #KERBALISM_HydrazineProduction_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemHydrazineProductionN2
			title = #KERBALISM_HydrazineProductionN2_title
			descriptionSummary = #KERBALISM_HydrazineProductionN2_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemSolidOxideElectrolysis
			title = #KERBALISM_SolidOxideElectrolysis_title
			descriptionSummary = #KERBALISM_SolidOxideElectrolysis_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemMoltenRegolithElectrolysis
			title = #KERBALISM_MoltenRegolithElectrolysis_title
			descriptionSummary = #KERBALISM_MoltenRegolithElectrolysis_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
    SUBTYPE
		{
			name = ChemSelectiveCatalyticOxidation
			title = #KERBALISM_SelectiveCatalyticOxidation_title
			descriptionSummary = #KERBALISM_SelectiveCatalyticOxidation_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          switchId = #$../../../moduleID$
        }
        DATA {
          definition = #$../../name$
        }
      }
		}
  }
}


